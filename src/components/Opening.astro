---
// src/components/Opening.astro
import { UNDANGAN_CONFIG } from '../data/config'
import OrnamentBackground from './OrnamentBackground.astro'

// Ambil data yang diperlukan
const {
  brideName,
  groomName,
  quote,
  countdownTargetDate // <-- Nilai yang akan di-pass ke JS
} = UNDANGAN_CONFIG

const targetDateValue = countdownTargetDate
// Ambil inisial nama
const brideInitial = brideName[0]
const groomInitial = groomName[0]
---

<div
  id="opening"
  class="angkasa_slide px-4 sm:px-6 relative min-h-screen flex flex-col justify-center items-center snap-start"
  data-section="opening"
>
  <OrnamentBackground />

  <div
    class="blur-card bg-white/30 backdrop-blur-sm rounded-3xl mt-7 h-full w-full flex flex-col justify-center items-center"
    style="padding-bottom: 30%"
  >
    <div class="content-layer text-center m-3 sm:m-5 font-dekor-1">
      <div
        data-animation-class="animate__fadeInDown"
        class="text-center text-lg mb-4 ornament-item animate__slower"
      >
        <p class="font-judul italic color-accent">✤ Assalamualaikum Wr.Wb ✤</p>
        <p
          data-animation-class="animate__fadeInDown"
          class="ornament-item mt-2 text-[15px] mb-6 animate__slower"
        >
          Tanpa mengurangi rasa hormat, Kami bermaksud Mengundang Bapak/Ibu/Saudara/i, Untuk Hadir
          Dalam Acara Pernikahan kami
        </p>
      </div>

      <div
        data-animation-class="animate__zoomIn"
        class="flex items-center justify-center mb-4 mx-auto relative ornament-item animate__slower"
        style="
                  height: 112px;
                  width: 65px;
                  background-image: url('/asset/images/way-kecil.png');
                  background-repeat: no-repeat;
                  background-size: contain;
                  background-position: center;
                "
      >
        <div
          class="text-left font-accent absolute"
          style="
                    font-size: 55px;
                    line-height: 1;
                    transform: translate(-15px, 0px);
                  "
        >
          {brideInitial}
        </div>
        <div
          class="text-right font-accent absolute"
          style="
                    font-size: 55px;
                    line-height: 1;
                    transform: translate(15px, 25px);
                  "
        >
          {groomInitial}
        </div>
      </div>

      <div class="w-full flex items-center justify-center mt-2">
        <div
          data-animation-class="animate__fadeInLeft"
          class="text-center ornament-item animate__slower"
          style="width: 40%"
        >
          <div class="color-accent font-accent text-5xl" style="line-height: 1">
            {brideName}
          </div>
        </div>

        <div
          data-animation-class="animate__fadeInUp"
          class="px-2 font-accent text-5xl ornament-item animate__slower"
        >
          &amp;
        </div>

        <div
          data-animation-class="animate__fadeInRight"
          class="text-center ornament-item animate__slower"
          style="width: 40%"
          data-aos="fade-left"
          data-aos-delay="1100"
        >
          <div class="color-accent font-accent text-5xl" style="line-height: 1">
            {groomName}
          </div>
        </div>
      </div>
      <!-- COUNTDOWN TIMER -->
      <div
        id="opening-countdown-display"
        data-animation-class="animate__fadeInUp"
        class="mb-10 mt-4 ornament-item animate__slower w-full"
        data-countdown-target={countdownTargetDate}
      >
        <div
          id="countdown-display-opening"
          class="grid grid-cols-4 items-center justify-center gap-2 text-center font-dekor-1 max-w-xs mx-auto"
        >
          <!-- Hari (Days) -->
          <div class="bg-white/10 backdrop-blur-md px-1 sm:px-3 py-2 rounded-lg shadow-lg flex-1">
            <div id="days-opening" class="text-xl sm:text-2xl font-bold color-accent leading-none">
              00
            </div>
            <div class="text-xs color-accent opacity-80 mt-1">Hari</div>
          </div>

          <!-- Jam (Hours) -->
          <div class="bg-white/10 backdrop-blur-md px-1 sm:px-3 py-2 rounded-lg shadow-lg flex-1">
            <div id="hours-opening" class="text-xl sm:text-2xl font-bold color-accent leading-none">
              00
            </div>
            <div class="text-xs color-accent opacity-80 mt-1">Jam</div>
          </div>

          <!-- Menit (Minutes) -->
          <div class="bg-white/10 backdrop-blur-md px-1 sm:px-3 py-2 rounded-lg shadow-lg flex-1">
            <div
              id="minutes-opening"
              class="text-xl sm:text-2xl font-bold color-accent leading-none"
            >
              00
            </div>
            <div class="text-xs color-accent opacity-80 mt-1">Menit</div>
          </div>

          <!-- Detik (Seconds) - MENGHAPUS 'hidden sm:block' AGAR TAMPIL DI MOBILE -->
          <div class="bg-white/10 backdrop-blur-md px-1 sm:px-3 py-2 rounded-lg shadow-lg flex-1">
            <div
              id="seconds-opening"
              class="text-xl sm:text-2xl font-bold color-accent leading-none"
            >
              00
            </div>
            <div class="text-xs color-accent opacity-80 mt-1">Detik</div>
          </div>
        </div>
      </div>
      <!-- AKHIR COUNTDOWN TIMER -->
    </div>
  </div>
  <!-- FIX: Membungkus manten.png dalam div agar ukurannya lebih terkontrol saat lazy load -->
  <div
    data-animation-class="animate__zoomIn"
    class="image- mx-auto ornament-item animate__slower absolute z-30 mt-2"
    style="height: auto; width: 200px; overflow: hidden; bottom: 30px"
  >
    <img
      src="/asset/images/manten.webp"
      alt="301467-gallery-rNpYuhv9jd.png"
      class="w-full h-full object-contain"
      onerror="this.src='https://placehold.co/300x200/C6915A/white?text=MANTEN'"
    />
  </div>
  <script is:inline>
    function initializeOpeningCountdown() {
      // BARU: Ambil tanggal dari atribut data
      const countdownContainer = document.getElementById('opening-countdown-display')
      if (!countdownContainer) return
      const COUNTDOWN_TARGET = countdownContainer.getAttribute('data-countdown-target')
      const targetDate = new Date(COUNTDOWN_TARGET).getTime()
      const display = document.getElementById('countdown-display-opening') // Pastikan tanggal valid (cek NaN)
      if (isNaN(targetDate)) {
        console.error('Countdown target date is invalid:', COUNTDOWN_TARGET)
        if (display)
          display.innerHTML =
            '<span class="text-xl font-bold text-red-500">Tanggal Tidak Valid!</span>'
        return
      }

      const updateCountdown = () => {
        const now = new Date().getTime()
        const distance = targetDate - now

        if (distance < 0) {
          display.innerHTML =
            '<span class="text-xl font-bold color-accent-2">Acara Sedang Berlangsung!</span>'
          clearInterval(timerInterval)
          return
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24))
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))
        const seconds = Math.floor((distance % (1000 * 60)) / 1000) // Update Inner HTML menggunakan ID unik

        const daysEl = document.getElementById('days-opening')
        const hoursEl = document.getElementById('hours-opening')
        const minutesEl = document.getElementById('minutes-opening')
        const secondsEl = document.getElementById('seconds-opening')

        if (daysEl) daysEl.innerText = String(days).padStart(2, '0')
        if (hoursEl) hoursEl.innerText = String(hours).padStart(2, '0')
        if (minutesEl) minutesEl.innerText = String(minutes).padStart(2, '0')
        if (secondsEl) secondsEl.innerText = String(seconds).padStart(2, '0')
      }

      updateCountdown()
      const timerInterval = setInterval(updateCountdown, 1000)
    } // Panggil saat skrip dimuat
    initializeOpeningCountdown()
  </script>
</div>
