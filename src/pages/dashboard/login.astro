---
// src/pages/dashboard/login.astro
import { DASHBOARD_CONFIG } from '../../data/dashboard-config'
import Layout from '../../layouts/Layout.astro' // Pastikan path layout Anda benar

const { USERNAME, PASSWORD_SHA256, SESSION_KEY, SLUG } = DASHBOARD_CONFIG

// Menggunakan Astro.redirect untuk redirect sisi server jika sudah terautentikasi
if (Astro.cookies.get(SESSION_KEY) === PASSWORD_SHA256) {
  return Astro.redirect(`/${SLUG}`)
}
---

<Layout title="Login Dashboard">
  <div class="min-h-screen flex items-center justify-center p-4 bg-gray-900">
    <div class="max-w-md w-full p-8 bg-gray-800 rounded-xl shadow-2xl border-t-4 border-accent">
      <h2 class="text-3xl font-bold text-white text-center mb-6">Login Dashboard</h2>
      <p class="text-center text-gray-400 mb-8">Masukkan kredensial Anda untuk mengakses alat.</p>

      <form id="login-form" class="space-y-4">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Username</label
          >
          <input
            type="text"
            id="username"
            name="username"
            value={USERNAME}
            readonly
            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white cursor-not-allowed"
          />
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Password</label
          >
          <input
            type="password"
            id="password"
            name="password"
            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-accent focus:border-accent"
            required
          />
        </div>

        <button
          type="submit"
          id="login-button"
          class="w-full py-3 bg-accent text-black font-semibold rounded-lg shadow-lg hover:bg-accent-600 transition"
        >
          Masuk
        </button>
      </form>

      <p id="error-message" class="text-red-400 text-center mt-4 hidden"></p>
    </div>
  </div>
</Layout>

<script>
  import CryptoJS from 'crypto-js'
  import { DASHBOARD_CONFIG } from '../../data/dashboard-config'

  const { PASSWORD_SHA256, SESSION_KEY, SLUG } = DASHBOARD_CONFIG

  const form = document.getElementById('login-form')
  const passwordInput = document.getElementById('password')
  const errorMessage = document.getElementById('error-message')

  form.addEventListener('submit', async (e) => {
    e.preventDefault()
    errorMessage.classList.add('hidden')

    const enteredPassword = passwordInput.value

    // Hash password yang dimasukkan pengguna
    const enteredHash = CryptoJS.SHA256(enteredPassword).toString(CryptoJS.enc.Hex)

    if (enteredHash === PASSWORD_SHA256) {
      // Autentikasi berhasil: simpan hash di localStorage/cookie
      // Karena kita tidak punya server-side session, kita simpan hash di localStorage
      localStorage.setItem(SESSION_KEY, PASSWORD_SHA256)

      // Redirect ke halaman dashboard
      window.location.href = `/${SLUG}`
    } else {
      errorMessage.textContent = 'Username atau Password salah.'
      errorMessage.classList.remove('hidden')
      passwordInput.value = ''
    }
  })

  // Hapus cookie/session jika ada
  localStorage.removeItem(SESSION_KEY)
</script>
